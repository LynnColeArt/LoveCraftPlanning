flowchart TD
    subgraph Frontend
        UI[Web Interface]
        Chat[Chat Interface]
        PM[Parameter Controls]
        VS[Version System]
    end

    subgraph RAG System
        GPT[GPT4All]
        subgraph Vector Storage
            SVS[Streaming Vector Store]
            EL[Encryption Layer]
            PM2[Partition Manager]
            ACT[/Active Partitions/]
            ARC[/Archived Partitions/]
        end
        CP[Context Processor]
    end

    subgraph Analysis
        TML[/Terrible Music Library/]
        MTS[/Music Theory Statistics/]
    end

    subgraph LORA Modules
        TH[Theory LORA]
        GE[Genre LORA]
        HA[Harmony LORA]
        RH[Rhythm LORA]
        OR[Orchestration LORA]
        TR[20th Century Trends LORA]
        QF[Quality Filter]
    end

    subgraph Assets
        PRJ[Project Files]
        MIDI[MIDI Assets]
        AUD[Audio Assets]
    end

    subgraph Schema
        subgraph Core Tables
            INS[Instruments]
            GEN[Genres]
            EMO[Emotions]
        end
        
        subgraph Relationship Tables
            IE[Instrument-Emotion Maps]
            IG[Instrument-Genre Maps]
            GF[Genre Fusion Maps]
            PL[Physical Limits]
        end
    end

    subgraph Generation
        NOT[Notation Generator]
        MAG[Magenta]
        SA[Stable Audio]
    end

    UI --> Chat
    Chat --> GPT
    GPT --> CP
    CP --> SVS
    SVS --> EL
    EL --> PM2
    PM2 --> ACT
    PM2 --> ARC
    SVS --> Schema
    
    TML --> QF
    MTS --> TR
    TH --> TR
    TR --> GE
    GE --> HA
    HA --> RH
    RH --> OR
    OR --> QF
    QF --> NOT
    NOT --> MAG
    MAG --> |Optional| SA

    PM --> NOT
    VS --> PRJ
    PRJ --> MIDI
    MIDI --> AUD
